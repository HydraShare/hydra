<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Hydra Viewer</title>
	<link rel="icon" type="image/x-icon" href="./lib/favicon.ico">
	<link rel="stylesheet" type="text/css" href="./lib/style.css">
    <script src="./lib/d3.min.js"></script>
	<script src="./lib/highlight.min.js"></script>
	<script src="./lib/jquery-1.11.3.min.js"></script>
	<!-- libraries for share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
	<script type="text/javascript" src="https://w.sharethis.com/button/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "8146e8ed-b6ac-46c1-a80d-3d5c4ba828e3", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

	<style type="text/css">

	span.components,
	span.dependencies {
    	border-radius: 5px;
    	margin: 3px;
	    padding: 2px;
	    display: inline-block;
    	font-size: .9em;
    }

	span.components{
		border: 2px solid #BDC0C7;
	}

	span.dependencies {
		border: 2px solid #B73939;
	}

    div#imageContainer {
    	margin: auto;
    	display: block;
    	border: 3px solid #000000;
    	border-radius: 10px;
    	padding: 10px;
    }

    div#slideshow{
    	margin: 0 auto;
    	text-align: center;
    }

    button{
    	cursor: pointer;
    }

    </style>
</head>

<body>
<div class="header"></div>
<div>
	<h2 class="example-description"></h2>
	<span class='st_sharethis_hcount' displayText='ShareThis'></span>
	<span class='st_email_hcount' displayText='Email'></span>
	<span class='st_facebook_hcount' displayText='Facebook'></span>
	<span class='st_twitter_hcount' displayText='Tweet'></span>
	<span class='st_linkedin_hcount' displayText='LinkedIn'></span>
	<span class='st_googleplus_hcount' displayText='Google +'></span>
	<!-- <select id="versions" style = "float:right"> </select> -->
	<button id="zoomtoextents" style="float:right" type="button">ZoomToExtent</button>
</div>

<br>
<div id="imageContainer"></div>
<div id="slideshow">
	<!--
	<label><input type="radio" id="toggleView" name="viewMode" value="GH" title="image1" checked></label>
    <label><input type="radio" id="toggleView" name="viewMode" value="RH"></label>
    -->
</div>
<br>
<form id="example-download">
	<button id="downloadButton" type="button">Download</button>
	<div class="example-tags" style="float: right"></div>
</form>
<br>
<hr>
<div class="example-readme"></div>
<hr>
<div class="example-dependencies" style="width:960px" title="File Dependencies"></div>
<hr>
<div class="example-components" style="width:960px"  title="Component List"></div>
<hr>
<div id="disqus_thread"></div>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script data-cfasync="false" type="text/javascript">
var example,
	searchwkeywordbasepath = "https://hydrashare.github.io/hydra/index.html?keywords=";

function parseUri(){
	// This function parses uri to find owner and project name/description
	// and creates the base json object to generate the page

	var inputParameters = {
		owner : "",
		id : "",
		fork: ""
	}

	// parse Uri
	var pars = window.location.search.replace("?","").split("&")

	if (pars[0]=="") {
		alert("Can't find the file!");
		return;
	}

	pars.forEach(function(d){
		keyValue = d.split("=");
		inputParameters[keyValue[0].toLowerCase()] = decodeURIComponent(keyValue[1]);
	})

	var owner = inputParameters.owner,
		fork = inputParameters.fork,
		id = inputParameters.id;

	// read the json file
	var githubBase = "https://raw.githubusercontent.com/" + owner + "/" + fork + "/master/" + id;
	var jsonFile = githubBase + "/input.json";

    d3.json(jsonFile, function(error, data){

    	if (d3.keys(data).indexOf("dependencies") == -1) {
    		// this example if generated by an older version
    		// modify it for the newer version
    		data.images = [{}, {}];
    		data.images[0][data.ghimg] = "Grasshopper Definition";
    		data.images[1][data.rhinoimg] = "Rhino Viewport Screenshot";

    		data.dependencies = ["This example is generated by an old version of Hydra! Please re-generate the example file."];
    	}

    	// use the id to get the following github information
		example = {
			"githubBase": githubBase,
			"owner": owner,
			"description": id,
			"fork_path": "http://www.github.com/" + owner + "/" + fork + "/tree/master/" + id,
			"images": data.images,
			"download_path": githubBase + "/" + data.file,
			"readme_path": githubBase + "/README.md",
			"components": data.components,
			"dependencies": data.dependencies,
			"tags": data.tags,
			"versions": data.versions,
			"created_at":data.date
		};

		generateContent(example);
    });
	
    /** DISQUS COMMENTS
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
	var disqus_config = function () {
        this.page.url = window.location.href.replace("https","http");  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = example.description; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//hydrashare.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
};

parseUri();

function generateContent(){

	// script for title
	d3.select("title").text(example.description);

	// script for header
	var header = d3.select(".header").append("span")

	header.append("a")
		.attr("href", searchwkeywordbasepath + example.owner)
	  	.text(example.owner);

	header.append("span").text("'s example ");

	header.append("a")
	  .attr("title","View example on Github")
	  .attr("href", example.fork_path)
	  .text(example.description + " ");
	header.append("span")
	  .attr("class","date")
	  .text("created: " + example.created_at);
	header.append("a")
	  .attr("href","https://hydrashare.github.io/hydra/index.html")
	  .style("float","right")
	  .text("Return to Main Page")

	// script for description
	d3.select(".example-description").text(example.description.replace(/_/g, " "));


	// bind the download submit event to the form
	d3.select("button#downloadButton")
		.on("click", function(){
		//download the zip file from github
		window.location = example.download_path;
		});

	// change toggle view between images
	// add lable for each image in image list
	d3.select("#slideshow")
		.selectAll("lable")
		.data(example.images)
		.enter()
			.append("label")
			.append("input")
				.attr("type", "radio")
				.attr("id", "toggleView")
				.attr("name", "viewMode")
				.attr("title", function(d){return d3.values(d)[0];})
				.property("checked", function(d, i){ return i==0;}); // check the first one

    d3.selectAll("input#toggleView")
      .on("change", toggleView)

    function toggleView() {

        var imageName = d3.keys(d3.select(this).data()[0])[0];

		zoomtoextents();

    	svg.select("image")
    		.attr("xlink:href", function(d){ return example.githubBase + "/" + imageName;});
    }

	/*
	// add versions

	// add options based on input and outputs
    d3.select("select")
    	.text("version: ")
    	.selectAll("option")
      	.data(example.versions.reverse())
      	.enter()
        	.append("option")
        	.attr("value", function (d) { return d; })
        		.text(function (d) { return d; });

    // add change event to resort images
    d3.select("select").on("change", function(d) {
        version = d3.select(this).property("value");
        //console.log(version);
        // image, description and change log needs to be updated
    })

	*/

	// script for zooming and panning .png images
	var imgWidth = 960,imgHeight = 480,		// Image dimensions (don't change these)
	    width =  960, height = 480,        // Dimensions of cropped region
	    padding = 10,
	    translate0 = [0, 0], currentOffset = translate0,  // Initial offset
		scale0 = 1, currentZoom = scale0;   // Initial scale

	svg = d3.select("#imageContainer").append("svg")
	    .attr("width",  (width - (2.5 * padding)) + "px")
	    .attr("height", height + "px");

	var zoom = d3.behavior.zoom().scaleExtent([1, 8]).on("zoom", zoom);

	svg = svg.call(zoom)
	  .append("g");

	svg.append("image")
	    .attr("width",  (imgWidth - (2.5 * padding)) + "px")
	    .attr("height", imgHeight + "px")
	    .attr("xlink:href", function(){ return example.githubBase + "/" + d3.keys(example.images[0])[0]});

	function zoom() {
	  svg.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
	};

	function zoomtoextents(){
		svg.call(zoom.scale(1).translate([0,0]));
		svg.attr("transform", "translate(" + translate0 + ")scale(" + scale0 + ")")
	}

	d3.select("#zoomtoextents").on("click", zoomtoextents);

	// script for tags
	d3.select(".example-tags").selectAll("a")
		.data(example.tags)
		.enter()
			.append("a")
			.attr("href", function(d){ return searchwkeywordbasepath + d})
	  		.text(function(d){ return "#" + d + " "});

	// script for readme
	var readme = d3.select(".example-readme");
    d3.text(example.readme_path, function(error, content) {
        readme.html(new Showdown.converter().makeHtml(content));
        readme.selectAll("code").each(function() { hljs.highlightBlock(this); });
    });

    // add list of components
    d3.select(".example-dependencies")
    	.selectAll("span")
    	.data(example.dependencies)
    	.enter()
    		.append("span")
    		.attr("class", "dependencies")
    		.text(function(d){return " " + d + " ";});

    // add list of components
    d3.select(".example-components")
    	.selectAll("span")
    	.data(d3.keys(example.components))
    	.enter()
    		.append("span")
    		.attr("class", "components")
    		.text(function(d){return " " + example.components[d] + " X " + d + " "})
}
</script>

</html>
